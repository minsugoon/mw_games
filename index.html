<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Consecutive Limit (Both)</title>
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        body {
            font-family: 'Pretendard', -apple-system, sans-serif;
            background-color: #121212;
            color: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        /* ì‹œì‘ í™”ë©´ */
        .start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(18, 18, 18, 0.98);
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.3s;
            padding: 20px;
        }

        .main-title {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(to right, #ff6b6b, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0 0 10px 0;
            text-align: center;
        }

        .sub-title {
            color: #aaa;
            margin-bottom: 30px;
            font-size: 1rem;
        }

        .btn-start {
            background: linear-gradient(135deg, #fff 0%, #ddd 100%);
            color: #000;
            border: none;
            padding: 15px 50px;
            font-size: 1.3rem;
            font-weight: 900;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
            animation: pulse 2s infinite;
            margin-bottom: 30px;
        }

        /* ê·œì¹™ ë°•ìŠ¤ */
        .rules-box {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            width: 100%;
            max-width: 360px;
            font-size: 0.85rem;
            color: #ddd;
            line-height: 1.5;
        }

            .rules-box h3 {
                margin: 0 0 10px 0;
                font-size: 1rem;
                color: #ff6b6b;
                text-align: center;
                border-bottom: 1px solid rgba(255,255,255,0.1);
                padding-bottom: 8px;
            }

        .rules-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

            .rules-list li {
                margin-bottom: 8px;
                display: flex;
                align-items: flex-start;
            }

        .rules-icon {
            margin-right: 8px;
            min-width: 20px;
        }

        .alert-text {
            color: #ff6b6b;
            font-weight: bold;
            font-size: 0.95em;
            margin-top: 2px;
            display: block;
        }

        /* ê²Œì„ UI */
        .game-board {
            width: 90%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            opacity: 0;
            transition: opacity 0.5s;
        }

            .game-board.visible {
                opacity: 1;
            }

        .header {
            position: absolute;
            top: 20px;
            width: 100%;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .round-badge {
            background: #333;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #aaa;
            font-weight: bold;
        }

        .pot-container {
            background: linear-gradient(135deg, #2c3e50, #000000);
            border: 1px solid #444;
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.1);
            margin-bottom: 5px;
        }

        .pot-label {
            color: #ffd700;
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
        }

        .pot-value {
            font-size: 3.5rem;
            font-weight: 800;
            color: #fff;
            line-height: 1;
            text-shadow: 0 0 10px rgba(255,255,255,0.3);
        }

        .score-board {
            display: flex;
            justify-content: space-between;
            background: #1e1e1e;
            padding: 15px 25px;
            border-radius: 12px;
            border: 1px solid #333;
        }

        .player-info {
            text-align: center;
            flex: 1;
        }

        .p-name {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 4px;
            display: block;
        }

        .p-score {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .color-me {
            color: #4facfe;
        }

        .color-cpu {
            color: #ff6b6b;
        }

        .status-msg {
            text-align: center;
            min-height: 30px;
            color: #ccc;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: -5px;
        }

        /* ë²„íŠ¼ ë° ê²½ê³  ì˜ì—­ */
        .action-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .warning-box {
            text-align: center;
            font-size: 0.85rem;
            color: #888;
            min-height: 20px;
        }

        .warning-active {
            color: #ff6b6b;
            font-weight: bold;
            animation: flash 1s infinite;
        }

        .btn-group {
            display: flex;
            gap: 12px;
            height: 80px;
        }

        .btn {
            flex: 1;
            border: none;
            border-radius: 12px;
            font-size: 1.3rem;
            font-weight: 800;
            cursor: pointer;
            transition: transform 0.1s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            line-height: 1.2;
        }

            .btn:disabled {
                opacity: 0.3;
                filter: grayscale(100%);
                cursor: not-allowed !important;
                transform: none !important;
                background: #333;
                color: #555;
                box-shadow: none;
            }

            .btn span {
                font-size: 0.7rem;
                font-weight: normal;
                opacity: 0.8;
                margin-top: 4px;
            }

            .btn:active:not(:disabled) {
                transform: scale(0.96);
                opacity: 0.9;
            }

        .btn-we {
            background: #4facfe;
            color: #001e38;
        }

        .btn-me {
            background: #ff6b6b;
            color: #380000;
        }

        .log-area {
            height: 120px;
            overflow-y: auto;
            background: #111;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 10px;
            font-size: 0.85rem;
        }

        .log-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #222;
        }

        .reset-btn {
            margin-top: 15px;
            background: transparent;
            border: 1px solid #444;
            color: #666;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.5s;
            cursor: pointer;
        }

            .reset-btn.visible {
                opacity: 1;
            }

        .hidden {
            display: none !important;
            opacity: 0;
            pointer-events: none;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes flash {
            0%, 100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }
    </style>
</head>
<body>

    <div id="start-screen" class="start-screen">
        <h1 class="main-title">ME or WE</h1>
        <p class="sub-title">ìŒë°© ì—°ì† ì œí•œ (Dual Cooldown) Ver.</p>

        <button class="btn-start" onclick="startGame()">GAME START</button>

        <div class="rules-box">
            <h3>ğŸ“œ ê²Œì„ ê·œì¹™</h3>
            <ul class="rules-list">
                <li>
                    <span class="rules-icon">âš–ï¸</span>
                    <div><strong>ìŒë°© ì¿¨íƒ€ì„ ì ìš©:</strong><br><span class="alert-text">ë‚˜ì™€ AI ëª¨ë‘</span> ë°°ì‹ (ME)ì„ 2íšŒ ì—°ì†í•˜ë©´, ë‹¤ìŒ íŒì€ ë¬´ì¡°ê±´ í˜‘ë ¥(WE)í•´ì•¼ í•©ë‹ˆë‹¤.</div>
                </li>
                <li>
                    <span class="rules-icon">ğŸ¤–</span>
                    <div><strong>ë³µìˆ˜í•˜ëŠ” AI:</strong><br>ë‹¹ì‹ ì´ ë°°ì‹ í•˜ë©´, AIëŠ” ë‹¤ìŒ í„´ì— ë³µìˆ˜í•©ë‹ˆë‹¤.</div>
                </li>
                <li>
                    <span class="rules-icon">ğŸ’¥</span>
                    <div><strong>ë°°ì‹  ì‹¤íŒ¨ (ME & ME):</strong><br>ë‘˜ ë‹¤ ë¼ìš´ë“œ ì¶”ê°€ ì ìˆ˜(Pot) íšë“ ë¶ˆê°€ (0ì )</div>
                </li>
                <li>
                    <span class="rules-icon">ğŸ¤</span>
                    <div><strong>WE & WE:</strong> ê°ì 3ì  + ë¼ìš´ë“œ ì ìˆ˜</div>
                </li>
                <li>
                    <span class="rules-icon">ğŸ˜ˆ</span>
                    <div><strong>ë°°ì‹  ì„±ê³µ:</strong> ìŠ¹ì(5 + ë¼ìš´ë“œì ìˆ˜) / íŒ¨ì 0ì </div>
                </li>
                <li>
                    <div><strong>ë§Œë“  ì´:</strong> ë°©êµ¬ì„ ë¯¼ìˆ˜êµ°</div>
                </li>
            </ul>
        </div>
    </div>

    <div class="header" id="game-header">
        <span class="round-badge" id="round-badge">ROUND 1 / 10</span>
    </div>

    <div class="game-board" id="game-board">
        <div class="pot-container">
            <span class="pot-label">ì´ë²ˆ ë¼ìš´ë“œ ì¶”ê°€ ì ìˆ˜</span>
            <div class="pot-value" id="current-pot">?</div>
        </div>

        <div class="score-board">
            <div class="player-info">
                <span class="p-name">PLAYER</span>
                <span class="p-score color-me" id="p-score">0</span>
            </div>
            <div class="player-info">
                <span class="p-name">CPU</span>
                <span class="p-score color-cpu" id="c-score">0</span>
            </div>
        </div>

        <div class="status-msg" id="status-msg">ê²Œì„ ì‹œì‘ ëŒ€ê¸° ì¤‘...</div>

        <div class="action-area">
            <div class="warning-box" id="warning-display">
            </div>
            <div class="btn-group">
                <button id="btn-we" class="btn btn-we" onclick="playRound('WE')" disabled>WE<span>í˜‘ë ¥</span></button>
                <button id="btn-me" class="btn btn-me" onclick="playRound('ME')" disabled>ME<span>ë°°ì‹ </span></button>
            </div>
        </div>

        <div class="log-area" id="game-log">
            <div style="text-align:center; color:#444; padding-top:40px;">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>
        </div>
    </div>

    <button id="reset-btn" class="reset-btn" onclick="resetToStart()">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>

    <script>
        let playerScore = 0;
        let cpuScore = 0;
        let currentRound = 1;
        let currentPot = 0;
        const maxRounds = 10;
        let isRolling = false;

        // ì—°ì† ì œí•œ ê´€ë ¨ ë³€ìˆ˜
        let playerConsecutiveMe = 0; // í”Œë ˆì´ì–´ì˜ ì—°ì† ME íšŸìˆ˜
        let cpuConsecutiveMe = 0;    // CPUì˜ ì—°ì† ME íšŸìˆ˜ (ì‹ ê·œ ì¶”ê°€)

        // AI ì „ëµ ë³€ìˆ˜
        let lastPlayerChoice = null;

        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-board').classList.add('visible');
            document.getElementById('game-header').style.opacity = 1;
            document.getElementById('reset-btn').classList.add('visible');

            // ë³€ìˆ˜ ì´ˆê¸°í™”
            playerScore = 0;
            cpuScore = 0;
            currentRound = 1;
            lastPlayerChoice = null;
            playerConsecutiveMe = 0;
            cpuConsecutiveMe = 0; // ì´ˆê¸°í™”

            document.getElementById('p-score').innerText = 0;
            document.getElementById('c-score').innerText = 0;
            document.getElementById('game-log').innerHTML = '<div style="text-align:center; color:#444; padding-top:40px;">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            document.getElementById('warning-display').innerText = "";

            setNextRound();
        }

        function setNextRound() {
            const potElement = document.getElementById('current-pot');
            const msgElement = document.getElementById('status-msg');
            const warnElement = document.getElementById('warning-display');
            const btnWe = document.getElementById('btn-we');
            const btnMe = document.getElementById('btn-me');

            btnWe.disabled = true;
            btnMe.disabled = true;
            msgElement.innerText = "ì ìˆ˜ ì¶”ì²¨ ì¤‘...";
            msgElement.style.color = "#ccc";
            document.getElementById('round-badge').innerText = `ROUND ${currentRound} / ${maxRounds}`;

            let rollCount = 0;
            isRolling = true;
            const interval = setInterval(() => {
                potElement.innerText = "+" + (Math.floor(Math.random() * 10) + 1);
                rollCount++;
                if (rollCount > 15) {
                    clearInterval(interval);
                    currentPot = Math.floor(Math.random() * 10) + 1;
                    potElement.innerText = "+" + currentPot;
                    potElement.style.transform = "scale(1.2)";
                    setTimeout(() => potElement.style.transform = "scale(1)", 200);

                    // ë²„íŠ¼ ìƒíƒœ ê²°ì • ë¡œì§ (ì—°ì† 2íšŒ ì œí•œ í™•ì¸)
                    btnWe.disabled = false; // WEëŠ” í•­ìƒ ê°€ëŠ¥

                    if (playerConsecutiveMe >= 2) {
                        // 2íšŒ ì—°ì† ë°°ì‹ í–ˆë‹¤ë©´ ì´ë²ˆì—” ë°°ì‹  ê¸ˆì§€
                        msgElement.innerText = "ğŸš« ë°°ì‹  ë¶ˆê°€ (ì¿¨íƒ€ì„)";
                        msgElement.style.color = "#ff6b6b";

                        warnElement.innerText = "ì—°ì† ë°°ì‹ ìœ¼ë¡œ ì¸í•´ ì´ë²ˆ í„´ì€ í˜‘ë ¥(WE)ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.";
                        warnElement.classList.add('warning-active');

                        btnMe.disabled = true; // ME ë²„íŠ¼ ì ê¸ˆ
                    } else {
                        // ì •ìƒ í”Œë ˆì´ ê°€ëŠ¥
                        msgElement.innerText = "ì„ íƒí•´ì£¼ì„¸ìš”.";
                        btnMe.disabled = false;

                        warnElement.classList.remove('warning-active');
                        if (playerConsecutiveMe === 1) {
                            warnElement.innerText = "âš ï¸ ì£¼ì˜: ì´ë²ˆì— ë°°ì‹ í•˜ë©´ ë‹¤ìŒ í„´ì€ ë°°ì‹ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                            warnElement.style.color = "#ffaa00";
                        } else {
                            warnElement.innerText = "";
                        }
                    }

                    isRolling = false;
                }
            }, 50);
        }

        function getCpuChoice() {
            // [NEW] 0. CPU ì¿¨íƒ€ì„ ì²´í¬ (ìµœìš°ì„  ê·œì¹™)
            // CPUë„ 2ë²ˆ ì—°ì† ë°°ì‹ í–ˆìœ¼ë©´ ë¬´ì¡°ê±´ WEë¥¼ ë‚´ì•¼ í•¨
            if (cpuConsecutiveMe >= 2) {
                return 'WE';
            }

            // 1. ë³µìˆ˜ ì „ëµ
            if (lastPlayerChoice === 'ME') {
                return 'ME';
            }
            // 2. íƒìš• ì „ëµ (Pot >= 8 ì¼ë•Œ 40% í™•ë¥ )
            if (currentPot >= 8 && Math.random() < 0.4) {
                return 'ME';
            }
            // 3. ê¸°ë³¸ í˜‘ë ¥ í™•ë¥ 
            return Math.random() < 0.8 ? 'WE' : 'ME';
        }

        function playRound(playerChoice) {
            if (isRolling || currentRound > maxRounds) return;

            // í”Œë ˆì´ì–´ ì—°ì† ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            if (playerChoice === 'ME') {
                playerConsecutiveMe++;
            } else {
                playerConsecutiveMe = 0;
            }

            const cpuChoice = getCpuChoice();
            lastPlayerChoice = playerChoice;

            // [NEW] CPU ì—°ì† ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            if (cpuChoice === 'ME') {
                cpuConsecutiveMe++;
            } else {
                cpuConsecutiveMe = 0;
            }

            let pAdd = 0;
            let cAdd = 0;
            let msg = "";

            // ì ìˆ˜ ê³„ì‚° ë¡œì§
            if (playerChoice === 'WE' && cpuChoice === 'WE') {
                pAdd = 3 + currentPot;
                cAdd = 3 + currentPot;
                msg = "ğŸ¤ í˜‘ë ¥ ì„±ê³µ!";
            } else if (playerChoice === 'ME' && cpuChoice === 'ME') {
                pAdd = 1;
                cAdd = 1;
                msg = "âš”ï¸ ê³µë©¸... (ì¶”ê°€ì ìˆ˜ ì†Œë©¸)";
            } else if (playerChoice === 'ME' && cpuChoice === 'WE') {
                pAdd = 5 + currentPot;
                cAdd = 0;
                msg = "ğŸ˜ˆ ë°°ì‹  ì„±ê³µ!";
            } else {
                pAdd = 0;
                cAdd = 5 + currentPot;
                msg = "ğŸ˜­ ë°°ì‹  ë‹¹í•¨...";
            }

            playerScore += pAdd;
            cpuScore += cAdd;

            updateUI(playerChoice, cpuChoice, pAdd, cAdd, msg);
            currentRound++;

            if (currentRound <= maxRounds) {
                setTimeout(setNextRound, 1200);
            } else {
                setTimeout(endGame, 500);
            }
        }

        function updateUI(pChoice, cChoice, pAdd, cAdd, msg) {
            document.getElementById('p-score').innerText = playerScore;
            document.getElementById('c-score').innerText = cpuScore;

            const msgEl = document.getElementById('status-msg');
            let msgColor = '#fff';
            if (pAdd > cAdd) msgColor = '#4facfe';
            else if (pAdd < cAdd) msgColor = '#ff6b6b';
            else if (pChoice === 'ME') msgColor = '#ff6b6b';

            msgEl.innerHTML = `<span style="color:${msgColor}">${msg}</span>`;

            const logList = document.getElementById('game-log');
            if (currentRound === 1) logList.innerHTML = "";

            const logItem = document.createElement('div');
            logItem.className = 'log-item';
            logItem.innerHTML = `
                    <div style="font-size:0.8em; color:#888; width:40px;">R${currentRound}<br><span style="color:#ffd700">+${currentPot}</span></div>
                    <div style="flex:1; text-align:center;">
                        <span style="color:${pChoice === 'WE' ? '#4facfe' : '#ff6b6b'}">${pChoice}</span>
                        vs
                        <span style="color:${cChoice === 'WE' ? '#4facfe' : '#ff6b6b'}">${cChoice}</span>
                    </div>
                    <div style="font-weight:bold; width:60px; text-align:right;">
                        <span style="color:${pChoice === 'ME' && cChoice === 'ME' ? '#888' : '#4facfe'}">+${pAdd}</span> :
                        <span style="color:${pChoice === 'ME' && cChoice === 'ME' ? '#888' : '#ff6b6b'}">+${cAdd}</span>
                    </div>
                `;
            logList.insertBefore(logItem, logList.firstChild);
        }

        function endGame() {
            document.getElementById('current-pot').innerText = "-";
            document.getElementById('round-badge').innerText = "GAME OVER";
            document.getElementById('warning-display').innerText = "";
            document.getElementById('btn-we').disabled = true;
            document.getElementById('btn-me').disabled = true;

            let result = "";
            if (playerScore > cpuScore) result = "ğŸ‰ ë‹¹ì‹ ì˜ ìŠ¹ë¦¬ì…ë‹ˆë‹¤!";
            else if (playerScore < cpuScore) result = "ğŸ’€ ë‹¹ì‹ ì˜ íŒ¨ë°°ì…ë‹ˆë‹¤...";
            else result = "ğŸ¤ ë¬´ìŠ¹ë¶€ì…ë‹ˆë‹¤.";

            document.getElementById('status-msg').innerHTML = `<strong style="color:#ffd700">${result}</strong>`;
            alert(`ê²Œì„ ì¢…ë£Œ!\në‚˜: ${playerScore} vs CPU: ${cpuScore}\n\n${result}`);
        }

        function resetToStart() {
            document.getElementById('game-board').classList.remove('visible');
            document.getElementById('game-header').style.opacity = 0;
            document.getElementById('reset-btn').classList.remove('visible');
            setTimeout(() => { document.getElementById('start-screen').classList.remove('hidden'); }, 300);
        }
    </script>
</body>
</html>
